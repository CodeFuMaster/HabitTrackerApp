<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="HabitTrackerApp.MAUI.Views.StatisticsPage"
             xmlns:viewmodels="clr-namespace:HabitTrackerApp.MAUI.ViewModels"
             x:DataType="viewmodels:StatisticsViewModel"
             Title="Statistics">

    <ContentPage.BindingContext>
        <viewmodels:StatisticsViewModel />
    </ContentPage.BindingContext>

    <ScrollView Padding="20">
        <StackLayout Spacing="20">
            <!-- Header -->
            <Border BackgroundColor="#6366F1"
                   Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="15" />
                </Border.StrokeShape>
                
                <StackLayout>
                    <Label Text="ðŸ“Š Your Progress"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalOptions="Center" />
                    <Label Text="Track your habit completion and streaks"
                           FontSize="14"
                           TextColor="White"
                           Opacity="0.9"
                           HorizontalOptions="Center" />
                </StackLayout>
            </Border>

            <!-- Overall Stats Cards -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Total Habits -->
                <Border Grid.Row="0" Grid.Column="0"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#1F2937}"
                       Margin="0,0,5,5"
                       Padding="20">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    
                    <StackLayout HorizontalOptions="Center">
                        <Label Text="{Binding TotalHabits}"
                               FontSize="32"
                               FontAttributes="Bold"
                               TextColor="#6366F1"
                               HorizontalOptions="Center" />
                        <Label Text="Total Habits"
                               FontSize="12"
                               TextColor="#6B7280"
                               HorizontalOptions="Center" />
                    </StackLayout>
                </Border>

                <!-- Active Habits -->
                <Border Grid.Row="0" Grid.Column="1"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#1F2937}"
                       Margin="5,0,0,5"
                       Padding="20">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    
                    <StackLayout HorizontalOptions="Center">
                        <Label Text="{Binding ActiveHabits}"
                               FontSize="32"
                               FontAttributes="Bold"
                               TextColor="#10B981"
                               HorizontalOptions="Center" />
                        <Label Text="Active Habits"
                               FontSize="12"
                               TextColor="#6B7280"
                               HorizontalOptions="Center" />
                    </StackLayout>
                </Border>

                <!-- Completion Rate -->
                <Border Grid.Row="1" Grid.Column="0"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#1F2937}"
                       Margin="0,5,5,0"
                       Padding="20">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    
                    <StackLayout HorizontalOptions="Center">
                        <Label Text="{Binding OverallCompletionRate, StringFormat='{0:P0}'}"
                               FontSize="32"
                               FontAttributes="Bold"
                               TextColor="#F59E0B"
                               HorizontalOptions="Center" />
                        <Label Text="Completion Rate"
                               FontSize="12"
                               TextColor="#6B7280"
                               HorizontalOptions="Center" />
                    </StackLayout>
                </Border>

                <!-- Best Streak -->
                <Border Grid.Row="1" Grid.Column="1"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#1F2937}"
                       Margin="5,5,0,0"
                       Padding="20">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    
                    <StackLayout HorizontalOptions="Center">
                        <Label Text="{Binding BestStreak}"
                               FontSize="32"
                               FontAttributes="Bold"
                               TextColor="#EF4444"
                               HorizontalOptions="Center" />
                        <Label Text="Best Streak"
                               FontSize="12"
                               TextColor="#6B7280"
                               HorizontalOptions="Center" />
                    </StackLayout>
                </Border>
            </Grid>

            <!-- Recent Activity -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1F2937}"
                   Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                
                <StackLayout>
                    <Label Text="ðŸ“ˆ Recent Activity"
                           FontSize="18"
                           FontAttributes="Bold"
                           Margin="0,0,0,15" />
                    
                    <CollectionView ItemsSource="{Binding RecentActivity}"
                                  HeightRequest="200"
                                  BackgroundColor="Transparent">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0"
                                           BackgroundColor="#10B981"
                                           WidthRequest="8"
                                           HeightRequest="8"
                                           VerticalOptions="Center"
                                           Margin="0,0,15,0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="4" />
                                        </Border.StrokeShape>
                                    </Border>

                                    <StackLayout Grid.Column="1">
                                        <Label Text="{Binding HabitName}"
                                               FontSize="14"
                                               FontAttributes="Bold" />
                                        <Label Text="{Binding Description}"
                                               FontSize="12"
                                               TextColor="#6B7280" />
                                    </StackLayout>

                                    <Label Grid.Column="2"
                                           Text="{Binding CompletedAt, StringFormat='{0:MMM dd}'}"
                                           FontSize="12"
                                           TextColor="#6B7280"
                                           VerticalOptions="Center" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Border>

            <!-- Top Performing Habits -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1F2937}"
                   Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                
                <StackLayout>
                    <Label Text="ðŸ† Top Performing Habits"
                           FontSize="18"
                           FontAttributes="Bold"
                           Margin="0,0,0,15" />
                    
                    <CollectionView ItemsSource="{Binding TopHabits}"
                                  HeightRequest="250"
                                  BackgroundColor="Transparent">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <Label Grid.Column="0"
                                           Text="{Binding Rank, StringFormat='#{0}'}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="#6366F1"
                                           VerticalOptions="Center"
                                           Margin="0,0,15,0" />

                                    <StackLayout Grid.Column="1">
                                        <Label Text="{Binding Name}"
                                               FontSize="16"
                                               FontAttributes="Bold" />
                                        <Label Text="{Binding Category.Name, StringFormat='Category: {0}'}"
                                               FontSize="12"
                                               TextColor="#6B7280" />
                                    </StackLayout>

                                    <StackLayout Grid.Column="2" HorizontalOptions="End">
                                        <Label Text="{Binding CompletionRate, StringFormat='{0:P0}'}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="#10B981"
                                               HorizontalOptions="End" />
                                        <Label Text="completion"
                                               FontSize="12"
                                               TextColor="#6B7280"
                                               HorizontalOptions="End" />
                                    </StackLayout>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Border>

            <!-- Monthly Progress -->
            <Border BackgroundColor="{AppThemeBinding Light=White, Dark=#1F2937}"
                   Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                
                <StackLayout>
                    <Label Text="ðŸ“… This Month's Progress"
                           FontSize="18"
                           FontAttributes="Bold"
                           Margin="0,0,0,15" />
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackLayout Grid.Column="0">
                            <Label Text="{Binding MonthlyCompletedSessions}"
                                   FontSize="28"
                                   FontAttributes="Bold"
                                   TextColor="#10B981"
                                   HorizontalOptions="Center" />
                            <Label Text="Sessions Completed"
                                   FontSize="12"
                                   TextColor="#6B7280"
                                   HorizontalOptions="Center" />
                        </StackLayout>

                        <StackLayout Grid.Column="1">
                            <Label Text="{Binding MonthlyStreak}"
                                   FontSize="28"
                                   FontAttributes="Bold"
                                   TextColor="#EF4444"
                                   HorizontalOptions="Center" />
                            <Label Text="Current Streak"
                                   FontSize="12"
                                   TextColor="#6B7280"
                                   HorizontalOptions="Center" />
                        </StackLayout>
                    </Grid>
                </StackLayout>
            </Border>
        </StackLayout>
    </ScrollView>
</ContentPage>